---
import { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'splinterlands'>;
  earningsValue: string;
  significantVoters: any[]; // Adjust type as needed
  additionalVotesCount: number;
  headings: { depth: number; slug: string; text: string }[]; // New prop for headings
  hivePostUrl: string;
}

const { entry, earningsValue, significantVoters, additionalVotesCount, headings, hivePostUrl } = Astro.props;
---

{/* Post Details Section */}
<div class="mb-6 bg-white p-4 rounded-lg">
  <h3 class="text-2xl font-bold mb-4">Post Details</h3>
  <p>Votes: {entry.data.votes || 0}</p>
  <p>Comments: {entry.data.comments || 0}</p>
  <p>Earnings: {earningsValue}</p>

  <h4 class="text-xl font-bold mt-4 mb-2">Voters</h4>
  <details class="cursor-pointer">
    <summary class="text-blue-600 hover:underline">Show {entry.data.votes || 0} Voters</summary>
    <ul class="list-disc list-inside mt-2 text-sm">
      {significantVoters.map(voter => (
        <li>{voter.voter} ({parseFloat(voter.hbd_value).toFixed(3) || '0.000'} HBD)</li>
      ))}
      {additionalVotesCount > 0 && (
        <li>{additionalVotesCount} additional votes (less than 0.01 HBD)</li>
      )}
    </ul>
  </details>

  <h4 class="text-xl font-bold mt-4 mb-2">Beneficiaries</h4>
  {
    entry.data.beneficiaries && entry.data.beneficiaries.length > 0 ? (
      <ul class="list-disc list-inside mt-2 text-sm">
        {entry.data.beneficiaries.map(b => (
          <li>{b.account} ({b.weight / 100}%)</li>
        ))}
      </ul>
    ) : (
      <p class="text-sm text-gray-600">No beneficiaries.</p>
    )
  }
</div>

{/* Table of Contents Section */}
{headings.length > 0 && (
  <div class="bg-white p-4 rounded-lg sticky top-32">
    {/* CTA Button */}
    <div class="mb-6">
      <a href={hivePostUrl} target="_blank" rel="noopener noreferrer" class="w-full bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded text-center block">
        Vote for this post
      </a>
    </div>
    <h4 class="text-xl font-bold mb-2">Table of Contents</h4>
    <nav>
      <ul class="list-none p-0 m-0">
        {headings.map(heading => (
          <li class:list={{
            'ml-4': heading.depth === 3, // Indent H3
            'ml-0': heading.depth === 2
          }}>
            <a href={`#${heading.slug}`} class="text-blue-600 hover:underline text-sm">
              {heading.text}
            </a>
          </li>
        ))}
      </ul>
    </nav>
  </div>
)}